.table {
    --shadow: hsla(0 0% 0% / .1) 0 .5em 2em;

    position: relative;
    display: block grid;
    grid-template-columns: repeat(var(--columns), minmax(max-content, auto));
    align-content: start;
    padding-inline: 1px;
    margin-inline: -1px;
    overflow: auto;
    background-color: inherit;
    isolation: isolate;

    block-size: 100%;

    & input[type="checkbox"] {
        margin: .1em;
    }

    & .cell {
        display: block grid;
        padding: var(--padding-m);
        border: 1px solid transparent;
        border-radius: var(--radii-m);
        background: inherit;
        white-space: nowrap;

        &:has(textarea:focus) {
            border-color: var(--info);
        }

        & > span {
            align-self: center;
        }

        &:first-of-type {
            position: sticky;
            inset-inline-start: calc(var(--padding-m) * var(--depth));
            padding-inline-start: calc(var(--padding-m) * (1 + var(--depth)));
            z-index: 1;

            &::after {
                content: '';
                position: absolute;
                inset-inline-start: 100%;
                inset-block-start: -2px;
                display: block;
                inline-size: 2em;
                block-size: calc(3px + 100%);
                background: linear-gradient(90deg, hsla(0 0% 0% / .05), transparent);
                animation: column-scroll-shadow linear both;
                animation-timeline: scroll(inline);
                animation-range: 0 2em;
            }
        }
    }

    & :is(.header, .main, .footer) {
        grid-column: span calc(2 + var(--columns));
        display: block grid;
        grid-template-columns: subgrid;
    }

    & .header {
        position: sticky;
        inset-block-start: 0;
        border-block-end: 1px solid var(--surface-300);
        background-color: inherit;
        z-index: 2;
        animation: header-scroll-shadow linear both;
        animation-timeline: scroll();
        animation-range: 0 2em;

        & > aside {
            position: sticky;
            inset-inline-start: 0;
            background: inherit;
            padding: var(--padding-m);
            z-index: 1;
        }
    }

    & .main {
        background-color: inherit;
    }

    & .row {
        --alpha: 0;
        grid-column: span calc(2 + var(--columns));
        display: block grid;
        grid-template-columns: subgrid;
        border: 1px solid transparent;
        background-color: inherit;
        background-image: linear-gradient(0deg, oklch(from var(--info) l c h / var(--alpha)), oklch(from var(--info) l c h / var(--alpha)));

        &:has(> aside > :checked) {
            --alpha: .1;
            border-color: var(--info);

            & span {
                font-variation-settings: 'GRAD' 1000;
            }

            /* Remove the top border when directly preceded by a selected row */
            & + :has(> aside > :checked) {
                border-block-start-color: transparent;
            }

            /* Remove the top border when directly succeeded by a selected row */
            &:has(+ .row > aside > :checked) {
                border-block-end-color: transparent;
            }
        }

        &:hover {
            --alpha: .2 !important;
        }

        & > aside {
            position: sticky;
            inset-inline-start: 0;
            background: inherit;
            padding: var(--padding-m);
            z-index: 1;
        }
    }

    & details {
        display: contents;
        background-color: inherit;

        &::details-content {
            grid-column: span calc(2 + var(--columns));
            display: block grid;
            grid-template-columns: subgrid;
            background-color: inherit;
        }

        &:not([open])::details-content {
            display: none;
        }

        & > summary {
            position: sticky;
            inset-inline-start: 0;
            grid-column: 1;
            padding: .5em;
            padding-inline-start: calc(var(--depth) * 1em + .5em);
        }

        & > .row > .cell {
            padding-inline-start: calc(var(--depth) * 1em + var(--padding-m));
        }
    }

    &.selectable {
        grid-template-columns: 2em repeat(calc(var(--columns) - 1), minmax(max-content, auto));

        & .cell:first-of-type {
            inset-inline-start: calc(2em + var(--padding-m) * var(--depth));
        }

        & details > summary {
            inset-inline-start: 2em;
            grid-column: 2;
        }
    }
}

@property --depth {
    syntax: "<number>";
    inherits: false;
    initial-value: 0;
}

@keyframes header-scroll-shadow {
    from {
        box-shadow: none;
    }

    to {
        box-shadow: var(--shadow);
    }
}

@keyframes column-scroll-shadow {
    from {
        background: linear-gradient(90deg, transparent, transparent);
    }

    to {
        background: linear-gradient(90deg, hsla(0 0% 0% / .05), transparent);
    }
}